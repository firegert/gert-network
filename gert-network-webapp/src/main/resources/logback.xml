<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>
    <springProperty scope="context" name="springAppName" source="spring.application.name"/>
    <property name="APPLICATION_LOG_LEVEL" value="${APP_LOG_LEVEL:-info}"/>
    <property name="SPRING_APPLICATION_NAME" value="${springAppName:-gert-network}"/>
    <property name="LOG_DIR" value="${APP_LOG_DIR:-logs}"/>
    <property name="LOG_FILE_NAME" value="${APP_LOG_FILE_NAME:-${SPRING_APPLICATION_NAME:-gert-network}}"/>
    <property name="LOG_FILE_EXTENSION" value="${APP_LOG_FILE_EXTENSION:-log}"/>
    <property name="LOG_FILE_MAX_SIZE" value="${APP_LOG_FILE_MAX_SIZE:-10MB}"/>
    <property name="LOG_FILE_MAX_HISTORY" value="${APP_LOG_FILE_MAX_HISTORY:-2}"/>
    <property name="LOG_FILE" value="${LOG_FILE:-${LOG_DIR}/${LOG_FILE_NAME:-${SPRING_APPLICATION_NAME}}}"/>

    <appender name="CONSOLE_APPENDER" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} -%5p [${SPRING_APPLICATION_NAME},%X{X-B3-TraceId:-},%X{X-B3-SpanId:-},%X{X-B3-ParentSpanId:-},%X{X-Span-Export:-}] ${PID:- } --- [%t] %-40.40logger{39}#%line: %m ${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}%n</pattern>
            <charset>utf8</charset>
        </encoder>
    </appender>

    <appender name="FILE_APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_FILE:-${user.home}/logs/${SPRING_APPLICATION_NAME}}.${LOG_FILE_EXTENSION}</file>
        <encoder>
            <charset>utf8</charset>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} -%5p [${SPRING_APPLICATION_NAME},%X{X-B3-TraceId:-},%X{X-B3-SpanId:-},%X{X-B3-ParentSpanId:-},%X{X-Span-Export:-}] ${PID:- } --- [%t] %-40.40logger{39}: %m ${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}%n</pattern>
        </encoder>
        <rollingPolicy
                class="ch.qos.logback.core.rolling.FixedWindowRollingPolicy">
            <fileNamePattern>${LOG_FILE}-%i.${LOG_FILE_EXTENSION}.zip</fileNamePattern>
            <minIndex>1</minIndex>
            <maxIndex>${LOG_FILE_MAX_HISTORY}</maxIndex>
        </rollingPolicy>
        <triggeringPolicy
                class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy">
            <maxFileSize>${LOG_FILE_MAX_SIZE}</maxFileSize>
        </triggeringPolicy>
    </appender>

    <logger name="com.firegert.network" level="${APPLICATION_LOG_LEVEL}"/>
    <logger name="org.springframework" level="${SPRING_LOG_LEVEL:-error}"/>
    <logger name="org.hibernate" level="error"/>
    <logger name="com.rabbitmq" level="error"/>
    <logger name="org.apache.http" level="error"/>
    <logger name="com.zaxxer.hikari" level="error"/>
    <logger name="com.netflix" level="error"/>
    <logger name="com.amazonaws" level="error"/>

    <root level="${ROOT_LOG_LEVEL:-info}"  additivity="false">
        <appender-ref ref="${APP_LOG_APPENDER_NAME:-CONSOLE_APPENDER}"/>
    </root>
</configuration>
